{"version":3,"file":"static/webpack/static/development/pages/index.js.6f6f09074808c5008652.hot-update.js","sources":["webpack:///./hooks/use-user.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport fetch from \"isomorphic-unfetch\";\n\nexport async function fetchUser(cookie = \"\") {\n  if (typeof window !== \"undefined\" && window.__user) {\n    return window.__user;\n  }\n\n  const res = await fetch(\n    \"/api/me\",\n    cookie\n      ? {\n          headers: {\n            cookie,\n          },\n        }\n      : {}\n  );\n\n  if (!res.ok) {\n    delete window.__user;\n    return null;\n  }\n\n  const json = await res.json();\n  if (typeof window !== \"undefined\") {\n    window.__user = json;\n  }\n  return json;\n}\n\nexport function useFetchUser({ required } = {}) {\n  const [loading, setLoading] = useState(\n    () => !(typeof window !== \"undefined\" && window.__user)\n  );\n  const [user, setUser] = useState(() => {\n    if (typeof window === \"undefined\") {\n      return null;\n    }\n\n    return window.__user || null;\n  });\n\n  useEffect(() => {\n    if (!loading && user) {\n      return;\n    }\n    setLoading(true);\n    let isMounted = true;\n\n    fetchUser().then((user) => {\n      // Only set the user if the component is still mounted\n      if (isMounted) {\n        // When the user is not logged in but login is required\n        if (required && !user) {\n          window.location.href = \"/api/login\";\n          return;\n        }\n        setUser(user);\n        setLoading(false);\n      }\n    });\n\n    return () => {\n      isMounted = false;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return { user, loading };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AASA;AACA;AADA;AADA;AACA;AATA;AAKA;AACA;AANA;AAAA;AAAA;AAAA;AACA;AAgBA;AAjBA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAqBA;AACA;AAAA;AACA;AACA;AACA;AAzBA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA4BA;AAAA;AAAA;AACA;AADA;AAEA;AAAA;AAFA;AAAA;AACA;AADA;AAKA,iBAEA;AACA;AACA;AACA;AAVA;AAAA;AACA;AAWA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAAA;AAAA;AAAA;AACA;;;;A","sourceRoot":""}